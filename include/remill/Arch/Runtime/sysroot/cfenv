#pragma once

#ifndef __clang__
#  error Unsupported compiler!
#endif

// NOTE: These values have to match the hardware for correct semantics

#if defined(__arm__)

#  define FE_INVALID 1
#  define FE_DIVBYZERO 2
#  define FE_OVERFLOW 4
#  define FE_UNDERFLOW 8
#  define FE_INEXACT 16
#  define FE_ALL_EXCEPT 31

#  define FE_TONEAREST 0
#  define FE_DOWNWARD 0x800000
#  define FE_UPWARD 0x400000
#  define FE_TOWARDZERO 0xc00000

#elif defined(__aarch64__)

#  define FE_INVALID 1
#  define FE_DIVBYZERO 2
#  define FE_OVERFLOW 4
#  define FE_UNDERFLOW 8
#  define FE_INEXACT 16
#  define FE_ALL_EXCEPT 31

#  define FE_TONEAREST 0
#  define FE_DOWNWARD 0x800000
#  define FE_UPWARD 0x400000
#  define FE_TOWARDZERO 0xc00000

#elif defined(__powerpc__)

#  define FE_INEXACT 0x02000000
#  define FE_DIVBYZERO 0x04000000
#  define FE_UNDERFLOW 0x08000000
#  define FE_OVERFLOW 0x10000000
#  define FE_INVALID 0x20000000
#  define FE_ALL_EXCEPT 0x3e000000

#  define FE_TONEAREST 0
#  define FE_TOWARDZERO 1
#  define FE_UPWARD 2
#  define FE_DOWNWARD 3

#elif defined(__sparc__)

#  define FE_INVALID (1 << 9)
#  define FE_OVERFLOW (1 << 8)
#  define FE_UNDERFLOW (1 << 7)
#  define FE_DIVBYZERO (1 << 6)
#  define FE_INEXACT (1 << 5)
#  define FE_ALL_EXCEPT \
    (FE_INEXACT | FE_DIVBYZERO | FE_UNDERFLOW | FE_OVERFLOW | FE_INVALID)

#  define FE_TONEAREST (0 << 30)
#  define FE_TOWARDZERO (1 << 30)
#  define FE_UPWARD (-0x7fffffff - 1) /* (2 << 30) */
#  define FE_DOWNWARD (-0x40000000) /* (3 << 30) */

#elif defined(__sparc64__)

#  define FE_INVALID (1 << 9)
#  define FE_OVERFLOW (1 << 8)
#  define FE_UNDERFLOW (1 << 7)
#  define FE_DIVBYZERO (1 << 6)
#  define FE_INEXACT (1 << 5)
#  define FE_ALL_EXCEPT \
    (FE_INEXACT | FE_DIVBYZERO | FE_UNDERFLOW | FE_OVERFLOW | FE_INVALID)

#  define FE_TONEAREST (0 << 30)
#  define FE_TOWARDZERO (1 << 30)
#  define FE_UPWARD (-0x7fffffff - 1) /* (2 << 30) */
#  define FE_DOWNWARD (-0x40000000) /* (3 << 30) */

#elif defined(__i386__)

#  define FE_INVALID 1
#  define __FE_DENORM 2
#  define FE_DIVBYZERO 4
#  define FE_OVERFLOW 8
#  define FE_UNDERFLOW 16
#  define FE_INEXACT 32

#  define FE_ALL_EXCEPT 63

#  define FE_TONEAREST 0
#  define FE_DOWNWARD 0x400
#  define FE_UPWARD 0x800
#  define FE_TOWARDZERO 0xc00

#elif defined(__x86_64__)

#  define FE_INVALID 1
#  define __FE_DENORM 2
#  define FE_DIVBYZERO 4
#  define FE_OVERFLOW 8
#  define FE_UNDERFLOW 16
#  define FE_INEXACT 32

#  define FE_ALL_EXCEPT 63

#  define FE_TONEAREST 0
#  define FE_DOWNWARD 0x400
#  define FE_UPWARD 0x800
#  define FE_TOWARDZERO 0xc00

#else
#  error Unsupported architecture!
#endif

// TODO: actually implement these functions?

namespace std {

// https://en.cppreference.com/w/cpp/numeric/fenv/feround
int fesetround(int round);
int fegetround();

// https://en.cppreference.com/w/cpp/numeric/fenv/fetestexcept
int fetestexcept(int excepts);

// https://en.cppreference.com/w/c/numeric/fenv/feraiseexcept
int feraiseexcept(int excepts);

// https://en.cppreference.com/w/c/numeric/fenv/feclearexcept.html
int feclearexcept(int excepts);

}  // namespace std